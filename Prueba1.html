<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Saludos</title>

<style>
    body{
        font-family: "Arial";
        background-color: gray;
    }
    #titulo{
        font-size: xx-large;
    }
    #canvas{
        background-color: white;
        border-radius: 250px;
    }
    canvas{
        border-radius: 250px;

    }
</style>
</head>
<body>
<div id="titulo"><label class="Titulo">Threader</label></div>

<input type="button" id="gg" onclick="DibujarClavos()">

<input type="file" id="img" onchange="fun()">

<div>
    <canvas height="500" width="500" id="canvas" ></canvas>
    <canvas height="500" width="500" id="canvas2" ></canvas>

</div>
<script>
    let a = 1

    function fun()   {
        a++
    // document.getElementById("la").innerText = a.toString()
        console.log("pepe")
        console.log(a)
        let im = document.getElementById("img").files[0]
        let imm = new FileReader()
        imm.readAsDataURL(im)
        imm.onloadend = function (e) {
            let imagen = new Image()
            imagen.src = e.target.result
            imagen.onload = function (ev){
                let canvas = document.getElementById("canvas2")

                // canvas.height = imagen.height
                // canvas.width = imagen.width
                canvas.getContext("2d").drawImage(imagen,0,0,imagen.width,imagen.height,0,0,500,500)

            }
        }

}
    function DibujarClavos()
    {
        let canv = document.getElementById("canvas2")
        let heigh = canv.height
        let wid = canv.width
        canv = canv.getContext("2d")
        canv.beginPath()
        canv.strokeStyle = "red"
        canv.arc(wid/2,heigh/2, (wid/2 - 5), 0, Math.PI * 2, true)
        canv.stroke()

        let n = 200
        let Puntos = []
        for (let i = 0; i < n; i++)
        {
            let theta = Math.PI * 2/n
            let r = wid/2 - 5
            let x = r * Math.cos(theta*i) + wid/2
            let y = r * Math.sin(theta*i) + heigh/2
            Puntos[i] = [x, y]
            canv.beginPath()
            canv.strokeStyle = "red"
            canv.arc(x,y,1,0,Math.PI * 2,true)
            canv.stroke()
        }
        DibujarLineas(Puntos)

        for (let k=0; k<1;k++) {
            RemoverLineas(Puntos)
        }
    }

    function DibujarLineas(Puntos){
        // let canv = document.getElementById("canvas2").getContext("2d")
        //
        // for (let i = 0; i < Puntos.length; i++)
        // {
        //     canv.beginPath()
        //     canv.lineWidth = 0.1
        //
        //     for (let j = 0; j < Puntos.length; j++)
        //     {
        //         canv.moveTo(Puntos[i][0],Puntos[i][1])
        //         canv.lineTo(Puntos[j][0],Puntos[j][1])
        //     }
        //     canv.stroke()
        // }

    }

    function RemoverLineas(Puntos)
    {
        const canv2 = document.getElementById("canvas").getContext("2d")
        const canv = document.getElementById("canvas2").getContext("2d")
        let c = canv.getImageData(0,0,500,500)
        let px = c.data

        let p = [Puntos[0][0], Puntos[0][1]]
        let ppas = [Puntos[0][0], Puntos[0][1]]

       for (let P1 = 0; P1 < Puntos.length; P1++) {
           // let p = [Puntos[P1][0], Puntos[P1][1]]
           let sumRGB = []

           for (let P2 = 0; P2 < Puntos.length; P2++) {
               let p2 = [Puntos[P2][0], Puntos[P2][1]]

               // console.log('p: ',p , 'p2: ',p2, 'ppas: ',ppas)
               if ((p[0] == p2[0] && p[1] == p2[1]) || (p2[0] == ppas[0] && p2[1] == ppas[1]))
               {
                   console.log(P1,P2)
                   sumRGB[P2] = [null,p2]
                   continue
               }

               sumRGB[P2] = [0,[]]
               for (let n = 0; n < 1; n += 1 / 100) {
                   let x = p[0] + (p2[0] - p[0]) * n
                   let y = p[1] + (p2[1] - p[1]) * n
                   let i4 = (Math.round(y) * 500 + Math.round(x))*4
                   sumRGB[P2] = [sumRGB[P2][0] + px[i4] + px[i4 + 1] + px[i4 + 2], p2]
               }
           }

           let menor = [sumRGB[0][0], sumRGB[0][1]]

           for(let i=1;i < sumRGB.length; i++)
               if(sumRGB[i][0] < menor[0] && sumRGB[i][0] != null)
                   menor = [sumRGB[i][0], sumRGB[i][1]]

           dibujarLinea(p, menor)
           p = [menor[1][0], menor[1][1]]
       }

       function dibujarLinea(p, menor) {
           canv.beginPath()
           canv.strokeStyle = "white"
           canv.lineWidth = 1
           canv.moveTo(p[0],p[1])
           canv.lineTo(menor[1][0],menor[1][1])
           canv.stroke()
           canv.lineWidth = 0.1

           canv2.beginPath()
           canv2.strokeStyle = "black"
           canv2.lineWidth = 0.1
           canv2.moveTo(p[0],p[1])
           canv2.lineTo(menor[1][0],menor[1][1])
           canv2.stroke()
           canv2.lineWidth = 0.01

       }
        // let p2 = [menor[1]]
        // canv.beginPath()
        // canv.strokeStyle = "green"
        // canv.lineWidth = 1
        // canv.moveTo(p[0],p[1])
        // canv.lineTo(menor[1][0],menor[1][1])
        // canv.stroke()
        // canv.lineWidth = 0.1
        // for (let n = 0; n < 1; n += 1 / 100) {
        //     let x = p[0] + (p2[0] - p[0]) * n
        //     let y = p[1] + (p2[1] - p[1]) * n
        //     canv.beginPath()
        //     canv.strokeStyle = "green"
        //     canv.arc(x, y, 20, 0, Math.PI * 2, true)
        //     canv.stroke()
        // }


        // let x1 = Puntos[0][0]
        // let y1 = Puntos[0][1]
        //
        // let x2 = Puntos[1][0]
        // let y2 = Puntos[1][1]
        //
        // for(let n = 0; n < 1; n+= 1/100)
        // {
        //     let x = x1 + (x2-x1) * n
        //     let y = y1 + (y2-y1) * n
        //     canv.beginPath()
        //     canv.strokeStyle = "green"
        //
        //     canv.arc(x,y,2,0,Math.PI * 2,true)
        //     canv.stroke()
        //
        //     console.log(x,y)
        // }

    }




</script>
</body>
</html>
